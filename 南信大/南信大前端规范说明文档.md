[toc]

# 修订记录

|    日期    | 修订版本 |         修改描述         |  作者  |
| :--------: | :------: | :----------------------: | :----: |
| 2022/03/01 |   1.0    |           初稿           | 王乐翔 |
| 2022/09/11 |   1.1    |     修改组件开发规范     | 王乐翔 |
| 2022/10/15 |   1.2    | 增加格式化与this相关问题 | 王乐翔 |
| 2022/11/08 |   1.3    |       增加时间格式       | 王乐翔 |
| 2022/11/10 |   1.4    |    修改“图像文件命名”    | 王乐翔 |



# SVN前端库

**目录结构，建立在SVN根目录下。**

> 备份的版本超过99大版本递增，如2.0。

> 前端公用库
>
> > 公用组件库
> >
> > > 搜索类组件
> > >
> > > > 搜索-组件名
> > > >
> > > > > .vue文件代码（xxx.vue 1.0）
> > > > >
> > > > > .vue文件代码（xxx.vue 1.1）
> > > > >
> > > > > .md组件设计文档
> > > > >
> > > > > .md组件项目使用记录
> > >
> > > xxx类组件
> >
> > 公用方法库
> >
> > > [事例代码](#公共方法事例代码)  
> > >
> > > .md文档（版本记录、代码、组件项目使用记录）
> >
> > 公用样式库
> >
> > > [事例代码](#公共样式事例代码)  
> > >
> > > .md文档（版本记录、代码、组件项目使用记录）
> >
> > 公用图标库
> >
> > > 预警类
> > >
> > > > typhoon_white.png
> > > >
> > > > typhoon_yellow.png
> > > >
> > > > typhoon_red.png
> > > >
> > > > ...
> > >
> > > 表单类
> > >
> > > > eye_open_48*48.png
> > > >
> > > > eye_open_@2x.png
> > > >
> > > > eye_open_@4x.png
> > > >
> > > > eye_close_24*24.png
> > > >
> > > > ......
> > >
> > > xxx类
> >
> > 前端规范说明文档
> >
> > > .md说明文档



# SVN公司框架目录

**目录结构，建立在"SVN根目录/技术组/公司框架"下。**

> 公司框架
>
> > 前端
> >
> > > PC端
> > >
> > > > 框架代码文件夹
> > > > .md说明文档
> > >
> > > 移动端
> > >
> > > > 框架代码文件夹
> > > >
> > > > .md说明文档



# 公共方法事例代码

此文件名为`methodsUtils.js`存放于工具类

```js
/**
 * @description 生成指定位数 字母数字 验证码 （去除了O、0、i等不好识别的数字和字母）
 * @param { Number } 位数
 * @author 王乐翔
 * @createDate 2022/01/13
 * @lastEditDate 2022/03/08
 * @lastEditAuthor 王乐翔
 * @returns PS5s
 */
export const randomCoding = num => {
  const arr = ['A', 'a', 'B', 'b', 'C', 'c', 'D', 'd', 'E', 'e', 'F', 'f', 'G', 'g', 'H', 'h', 'J', 'j', 'K', 'k', 'L', 'M', 'm', 'N', 'n', 'P', 'p', 'Q', 'q', 'R', 'r', 'S', 's', 'T', 't', 'U', 'u', 'V', 'v', 'W', 'w', 'X', 'x', 'Y', 'y', 'Z', 'z', '2', '3', '4', '5', '6', '7', '8', '9']
  let verificationCode = ''
  let count = num ?? 4 // 默认返回四个
  for (let i = 0; i < count; i++) { verificationCode += arr[Math.floor(Math.random() * arr.length)] }
  return verificationCode
}

/**
 * @description 俩经纬度计算之间距离 （WGS84版本）
 * @param { String, String, String, String }
 * @author 王乐翔
 * @createDate 2022/07/25
 * @lastEditDate
 * @lastEditAuthor
 * @returns 
 */
export const getCoordinateDistance = (lat1, lng1, lat2, lng2) => {
  lat1 = lat1 * Math.PI / 180.0
  lat2 = lat2 * Math.PI / 180.0
  let lat3 = lat1 - lat2
  let lng3 = lng1 * Math.PI / 180.0 - lng2 * Math.PI / 180.0
  let s = 2 * Math.asin(Math.sqrt(Math.pow(Math.sin(lat3 / 2), 2) + Math.cos(lat1) * Math.cos(lat2) * Math.pow(Math.sin(lng3 / 2), 2)))
  s = s * 6378.137 //地球半径
  s = Math.round(s * 10000)
  return s
}
```



# 公共样式事例代码

此文件名为`mixin.scss`存放`SCSS`提供的样式封装（混入）

```scss
// 文本溢出省略号隐藏
@mixin textEllipsis($lineCount:1) {
  display: -webkit-box;
  overflow: hidden;
  text-overflow: ellipsis;
  word-wrap: break-word;
  -webkit-line-clamp: $lineCount; // 第几行省略，默认第一行。
  -webkit-box-orient: vertical;
}

// flex自定义 - 改变主轴居中
@mixin felxDirection {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
```



# 前端基础代码规范

## HTML类

### class命名

类名多单词用“-”分割，嵌套尽量不要超过四级。

```vue
  <div class="box-other">
    <div class="box-other-item">
      <div class="box-other-item-icon">
        <img src="@/assets/img/icons/xxx@2x.png" alt="">
      </div>
      <div class="box-other-item-title">title</div>
    </div>
  </div>
```



### HTML注释

多模块之间使用空格区分并使用注释说明，采用两种注释方式，根据内容选择。

```vue
  <div class="content">

    <!-- 主体头部 -->
    <div class="content-head"></div>

    <!-- 主体内容区域 start>
    <div class="content-warp">
      <!--主体内标题 -->
      <div class="content-warp-head">
        <span class="content-warp-head-desc"></span>
      </div>
      <!--主体内正文 -->
      <div class="content-warp-content">....</div>
    </div>
    <!--主体内容区域 end>

  </div>
```



### HTML单标签

如果双标签之间不需要写参数则尽量使用单标签，减少代码冗余。

```vue
<i class="trangle">...</i>
<i class="trangle" />
```



## 命名类

### CSS文件命名

全部采用小写方式， 优先选择单个单词命名，多个单词命名以短横线分隔。

> base.css（默认配置文件，其余全部采用SCSS）
>
> mixin.scss
>
> date-picker.scss
>
> input-number.scss



### 图像文件命名

采用横线区分类别，并且做好文件夹的分类处理。

> img
>
> > public
> >
> > > menu-aboutu.gif
> > >
> > > icon-windDirection.png
> > >
> > > pic-TV.jpg
> >
> > user
> >
> > > user-icon.jpg



### 变量、函数、组件命名

多单词必须采用驼峰语义化命名方式，如果需要分类则命名前加上分类名与下划线

**变量**

data中使用块级标签区分，增加可读性，但必须一行显示。

```js
  data () {
    return {
      /* 按钮相关 */
      showBtn: false,
      btnLevel: 1,
      btnStatus: null, // 这里可以加单个命名注释

      /* 地图相关 */
      showMap_gaoDe: false, // 分类命名使用下划线分割
      showMap_baiDu: false
    }
  }
```

**函数**

每一个函数前写出相应的注释

```js
    // 得到banner列表
    getBannerList(){

    },
    // 提交用户信息
    commitUserInfo(){

    },
    // 清除表单
    clearForm(){

    }
```

**组件**

统一使用同名目录结构，并且首字母大写。

> Banner
>
> > Banner.vue
> >
> > Xxx.vue

```vue
<template>
  <div class="Banner">Banner</div>
</template>

<script>
export default {
  name: 'Banner'
}
</script>

<style lang="scss" scoped>
.Banner {
}
</style>
```



## JS代码类

### 格式化问题

JS的格式化使用默认即可，不需要每个人有每个人的JS格式化插件。

> 未格式化代码

```js
    example       () {
      this.xxx    ('first', 'second',     'third')
    },
```

> 默认格式化

```js
    example () {
      this.xxx('first', 'second', 'third')
    },
```

> 各种格式化插件中的一种

```js
    example () {
      this.xxx(
        'first',
        'second',
        'third'
      )
    },
```



### 时间格式

无论接口返回什么时间格式，统一默认转换为：年-月-日 时:分:秒（`2022-11-08 12:34:56`）。



### 等于和全等问题

严格拒绝使用`xx == 0`这种代码对数值0或1进行判断。

```js
      const num = 0
      // 错误示范 1
      if (num) { // false
        // ...
      }
      // 错误示范 2
      if (num == 0) { // false = false
        // ...
      }
			// 正确示范
      if(num === 0){ // true
        // ...
      }
```



### this 问题

严格拒绝`that = this`这种古老且易错的方法，如遇到这种问题需使用箭头函数。

```js
      // 错误示范
      let that = this
      this.xxx = function () {
        let temp = that.temp
        // ...
      }

      // 正确示范
      this.yyy = () => {
        let temp = this.temp
        // ...
      }
```

推荐全部使用箭头函数进行书写代码

```js
      // 写法一
      // formatter: function (params) {
      //   return 'xxx'
      // }
      // 写法二
      // formatter (params) {
      //   return 'xxx'
      // },
      // 写法三
      // formatter: params => 'xxx'
```



### JS语句末尾分号

除极少数特定情况下必须写分号，不写分号JS执行时会自动添加，再写分号毫无意义。

**特定情况如下**

++、--后缀表达式作为新行的开始，在行首自动插入分号

```js
var a = 1
var b = 2
a
++
b
// 解析成了
var a = 1
var b = 2
a;
++b;
```

如果你本身就想写`++b`那还好点，但是如果你的本意是`a++`呢。结果却是b自增了。这也是为什么很多的代码规则里不建议你用`++`,`--`，而是用 `+=1`,`-=1`。

> 通俗来讲，如果一条语句以 "(" ,"[" , "/" , "+" , "-" 开始，它们极有可能和前面一条语句一起解析。



### 引号规范

根据大众习惯，HTML里统一使用双引号，JS里统一使用单引号。

> 注意：引号里需要嵌套引号的时候要遵循**外单内双**与**外双内单**原则。



### 同步异步

拒绝使用`.then`这种可以无限回调的代码而是使用`async` `await`转为同步代码。

> 回调地狱示范的错误代码

```js
    testFn () {
      axios.get('aaa')
        .then(res => {
          if (res) {
            // do something
            axios.get('bbb')
              .then(res => {
                // do something
                if (res) {
                  axios.get('ccc')
                    .then(res => {
                      // do something
                      if (res) {
                        // ...
                      }
                    })
                }
              })
          }
        })
    }
```



> 正确代码示范

除了拦截器中，不要在其它任何界面使用`axios.xxx()`，否则就没有必要去封装什么拦截器。

```js
    async testFn () {
      const res_aaa = await getRequest('aaa')
      // do something

      const res_bbb = await getRequest('bbb')
      // do something

      const res_ccc = await getRequest('ccc')
      // do something
    }
```



## Vue类

### 书写顺序

应该严格按照声明周期来书写，因为代码是按照声明周期来执行的。

**此规范顺序中嵌入了`components`、`props`、`data`、`name`、`watch`、`methods`、`computed`**

> **name**
>
> **components**
>
> **props**
>
> **data**
>
> beforeCreated
>
> created
>
> beforeMount
>
> mounted
>
> **watch**
>
> **methods**
>
> **computed**
>
> beforeUpdate
>
> update
>
> activated
>
> deactivated
>
> beforeUnmount
>
> unmounted
>
> errorCaptured
>
> renderTracked
>
> renderTriggered
>
> beforeDestory
>
> destoryed



### 组件、方法的模版注释

```js
/**
 * @description 接口请求当前时间往前推任意天
 * @param {Number：2，String:'2'} 往前推的天数 
 * @author 王乐翔
 * @createDate 2022/03/07
 * @lastEditDate
 * @lastEditAuthor
 * @returns [20220304000000,20220307000000]
 */
```



## 组件开发规范

### 说明

**components目录结构**

> public（存放公共组件）
>
> content（放项目组件）
>
> > Search
> >
> > > Search.vue（入口文件）
> > >
> > > Xxx.vue



**公共组件与项目组件的区别介绍：**

components组件目录下存放公共组件（public目录）与项目组件（content目录），公共组件的定义是可以在任意项目中使用，项目组件的定义是只能在本项目或者指定几种项目中才能使用。



### 开发规范

书写顺序也应该按照Vue声命周期来写，在props中监听父组件传递来的值与设置默认值。因为要保证组件可以在其他项目独立运行保证不报错（如未拿到接口数据），所以需要一个默认值。

> 如果组件中需要定义变量，应该写在data里。如this.key中，会优先去data中寻找key，data中没有会去props中寻找。

```js
  props: {
    // 数据列表
    list: {
      type: Array,
      default: [
        { title: 'xxx', name: 'xxx' }
      ]
    }
  }
```



#### 拒绝偷懒遗留问题组件

如做一个左右箭头切换页面数据的组件，那么在只有一条数据时应该取消箭头显示，多页中显示第一页时应该取消显示左箭头等。

如鼠标悬浮按钮应该鼠标应该出现小手状态、文字超出应该添加滚动条等等。



#### 调用组件方法

`props`属性传参我们只用来做初始化来使用。

- 采取`ref`的框架

> 这里我们推荐统一命名需求为`ref_`加上当前组件名

```vue
<TestComponent ref="ref_TestComponent" />
```

```js
this.$refs.ref_TestComponent.componentMethod('形参')
```

- 采取**事件总线**的框架

```js
this.$bus.$emit('xxx')
```



#### 注意事项

> > 组件内独立使用的变量如果写在props里，那么后期修改value可能会报错。
>>
> > 为了方便他人，每个props里写的变量名尽量要写注释。
> >
> > `this.$emit`触发方法返回数据返回当前整个item对象。
> >
> > `this.$emit`方法名规范（语义化），如下标准：
> >
> > > 展示地图写showMap，传递地图JSON对象。
> > >
> > > 展示表格showTable，传递表格JSON对象。
> > >
> > > 展示弹窗showPop，传递弹窗JSON对象。
> > >
> > > 展示弹窗showPop，传递弹窗JSON对象。
> > >
> > > 父组件使用时与this.$emit传递方法名命名一致，多个时使用showMap_gaode



### 关于公共组件开发的需求

公共组件要保证任意项目中使用，就需要更加灵活的配置。市面上常用的公共组件库有element、uView等等，其都做到了规范化大小或响应式大小或自定义大小。
因此，公用组件的大小及样式必须是动态的，但一定存在默认样式。通过父子传参的方式让CSS拿到JS变量即可。

1. 组件调用

```vue
<BoxOther boxWidth="540px" :dataList="otherList" />
```

2. 子组件拿到传递的值

```js
  props: {
    dataList: {
      type: Array,
      default: [
        { title: 'title' },
        { title: 'title' }
      ]
    },
    boxWidth: {
      type: String,
      default: '300px'
    },
    boxHeight: {
      type: String,
      default: '300px'
    },
    boxMargin: {
      type: String,
      default: '0 0 0 0'
    },
  }
```

3. HTML声明全局CSS变量

```vue
<div :style="[
  {'--boxWidth':boxWidth},
  {'--boxHeight':boxHeight},
  {'--boxMargin':boxMargin}
  ]" class="box-other">

...

</div>
```

4. CSS中使用全局CSS变量

```css
	box-sizing: border-box;
  margin: var(--boxMargin);
  width: var(--boxWidth);
  height: var(--boxHeight);
```



## 其它

- 删除不必要的注释，未完成的代码必须要写注释加以说明。
